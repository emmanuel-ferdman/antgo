"use strict";(self["webpackChunkantgo_web"]=self["webpackChunkantgo_web"]||[]).push([[603],{3603:function(e,t,a){a.r(t),a.d(t,{default:function(){return p}});var i=function(){var e=this,t=e._self._c;return t("b-container",{staticStyle:{"margin-top":"30px","max-width":"80%"}},[t("b-row",[t("b-jumbotron",{staticStyle:{width:"100%"},attrs:{header:e.title,lead:e.description}})],1),t("b-row",[t("b-col",[t("b-card",{staticClass:"mt-6",attrs:{header:"输入信息"}},[t("b-container",e._l(e.input_info,(function(a,i){return t("b-row",{key:i},["image"==a["type"]?t("b-col",{staticStyle:{"margin-top":"20px"}},[t("h5",[e._v(e._s(a["name"]))]),t("b-form-file",{attrs:{state:Boolean("finish"==a["status"]),placeholder:"拖拽文件至此...","drop-placeholder":"Drop file here...",accept:".jpg, .png, .jpeg","browse-text":"打开"},on:{input:function(t){return e.uploadfile(i)}},model:{value:a["value"],callback:function(t){e.$set(a,"value",t)},expression:"input['value']"}}),t("div",{staticClass:"mt-3"},[e._v("上传文件: "+e._s("finish"==a["status"]?a["value"].name+" 完成":""))])],1):e._e(),"video"==a["type"]?t("b-col",{staticStyle:{"margin-top":"20px"}},[t("h5",[e._v(e._s(a["name"]))]),t("b-form-file",{attrs:{state:Boolean("finish"==a["status"]),placeholder:"拖拽文件至此...","drop-placeholder":"Drop file here...",accept:".jpg, .png, .jpeg","browse-text":"打开"},on:{input:function(t){return e.uploadfile(i)}},model:{value:a["value"],callback:function(t){e.$set(a,"value",t)},expression:"input['value']"}}),t("div",{staticClass:"mt-3"},[e._v("上传文件: "+e._s("finish"==a["status"]?a["value"].name+" 完成":""))])],1):e._e(),"text"==a["type"]?t("b-col",[t("b-input-group",{staticClass:"mt-3",attrs:{prepend:a["name"]}},[t("b-form-input",{model:{value:a["value"],callback:function(t){e.$set(a,"value",t)},expression:"input['value']"}})],1)],1):e._e(),"slider"==a["type"]?t("b-col",{staticStyle:{"margin-top":"20px"}},[t("h5",[e._v(e._s(a["name"])+" "+e._s(a["value"]))]),t("b-input-group",{staticClass:"mt-3",attrs:{prepend:a["min"],append:a["max"]}},[t("b-form-input",{attrs:{type:"range",min:a["min"],max:a["max"]},model:{value:a["value"],callback:function(t){e.$set(a,"value",t)},expression:"input['value']"}})],1)],1):e._e(),"checkbox"==a["type"]?t("b-col",{staticStyle:{"margin-top":"20px"}},[t("b-form-checkbox",{attrs:{value:"1","unchecked-value":"0"},model:{value:a["value"],callback:function(t){e.$set(a,"value",t)},expression:"input['value']"}},[e._v(e._s(a["name"]))])],1):e._e(),"select"==a["type"]?t("b-col",{staticStyle:{"margin-top":"20px"}},[t("h5",[e._v(e._s(a["name"]))]),t("b-form-select",{attrs:{options:a["options"]},model:{value:a["value"],callback:function(t){e.$set(a,"value",t)},expression:"input['value']"}})],1):e._e()],1)})),1)],1)],1),t("b-col",[t("b-card",{staticClass:"mt-6",attrs:{header:"输出信息"}},[e.iserror?t("div",[t("b-alert",{attrs:{show:""}},[e._v(e._s(e.error_message))])],1):e.iswaiting?t("div",[t("count-down")],1):t("div",[t("b-container",e._l(e.output_info,(function(a,i){return t("b-row",{key:i},["image"==a["type"]?t("b-col",[t("div",{staticStyle:{display:"flex","flex-direction":"column","align-items":"center"}},[t("div",{staticStyle:{"font-size":"large","font-weight":"900"}},[e._v(e._s(a["name"]))]),t("div",[a["interactive"]?t("div",{staticStyle:{width:"400px",height:"400px"},attrs:{id:a["name"]}}):t("b-img",{staticStyle:{"max-width":"512px"},attrs:{src:a["value"],id:a["name"]}})],1)])]):e._e(),"text"==a["type"]?t("b-col",[t("b-input-group",{staticClass:"mt-3",attrs:{prepend:a["name"]}},[t("b-form-input",{attrs:{disabled:""},model:{value:a["value"],callback:function(t){e.$set(a,"value",t)},expression:"output['value']"}})],1)],1):e._e(),"number"==a["type"]?t("b-col",[t("b-input-group",{staticClass:"mt-3",attrs:{prepend:a["name"]}},[t("b-form-input",{attrs:{type:"number",disabled:""},model:{value:a["value"],callback:function(t){e.$set(a,"value",t)},expression:"output['value']"}})],1)],1):e._e()],1)})),1)],1)])],1)],1),t("b-row",{staticStyle:{"margin-top":"50px"}},[t("b-button",{staticStyle:{width:"100px"},attrs:{variant:"primary"},on:{click:function(t){return e.submit()}}},[e._v("提交")])],1)],1)},n=[],o=(a(3251),a(7244)),s=a.n(o),l={name:"Demo",data(){return{title:"",demo:"",description:"",input_info:[],output_info:[],image_meta_info:{},iswaiting:!1,iserror:!1,error_message:""}},mounted:function(){this.$route.params.name&&(this.demo=this.$route.params.name);var e=this;e.axios.get("/antgo/api/demo/query_config/",{params:{demo:e.demo}}).then((function(t){e.input_info=t.data["input"],e.title=t.data["title"],e.description=t.data["description"]})).catch((function(e){console.log(e)}))},methods:{uploadfile:function(e){this.input_info[e]["status"]="uploading";var t=new FormData;t.append("file",this.input_info[e].value),t.append("filename",this.input_info[e].value.name);var a=this;a.axios.post("/antgo/api/demo/upload/",t).then((t=>{a.input_info[e]["status"]="finish",a.$forceUpdate()}))},submit:function(){this.iswaiting=!0,this.iserror=!1;var e={input:[],element:[],demo:this.demo};for(var t in this.input_info)"image"==this.input_info[t]["type"]||"video"==this.input_info[t]["type"]?e["input"].push(this.input_info[t]["value"].name):e["input"].push(this.input_info[t]["value"]);for(let f in Object.keys(this.image_meta_info)){let t=Object.keys(this.image_meta_info)[f];var a=[],i=this.image_meta_info[t]["feature_layer"].getAllFeatures();for(var n in i)if("RECT"==i[n].type){var o=i[n].shape.width,s=i[n].shape.height,l=i[n].shape.x,r=i[n].shape.y;a.push({data:[l,r,l+o,r+s],type:"RECT"})}else if("POINT"==i[n].type)a.push({data:[i[n].shape.x,i[n].shape.y],type:"POINT"});else if("POLYGON"==i[n].type){var u=[];for(var m in i[n].shape.points)u.push([i[n].shape.points[m].x,i[n].shape.points[m].y]);a.push({data:u,type:"POLYGON"})}else"LINE"==i[n].type&&a.push({data:[[i[n]["shape"]["start"].x,i[n]["shape"]["start"].y],[i[n]["shape"]["end"].x,i[n]["shape"]["end"].y]],type:"LINE"});e["element"].push({name:t,value:a,mode:this.image_meta_info[t]["mode"]})}var p=this;let d=new FormData;d.append("query",JSON.stringify(e)),p.axios.post("/antgo/api/demo/submit/",d).then((function(e){p.output_info=e.data,p.iswaiting=!1,p.$nextTick((()=>{for(let n in e.data){var t=e.data[n]["name"];if("image"==e.data[n]["type"])if(!(t in p.image_meta_info)&&e.data[n]["interactive"])p.initMap(e.data[n]["name"],e.data[n]["value"],e.data[n]["height"],e.data[n]["width"]),p.setMode(e.data[n]["name"],e.data[n]["element"]["mode"],e.data[n]["element"]["num"]);else if(t in p.image_meta_info&&e.data[n]["interactive"]){var a=p.image_meta_info[t]["feature_layer"].getAllFeatures();for(var i in p.initMap(e.data[n]["name"],e.data[n]["value"],e.data[n]["height"],e.data[n]["width"]),p.setMode(e.data[n]["name"],e.data[n]["element"]["mode"],e.data[n]["element"]["num"]),a)p.image_meta_info[t]["feature_layer"].addFeature(a[i])}}}))})).catch((function(e){p.iserror=!0,p.error_message="["+e.response.status.toString()+"]:"+e.response.data.detail})).finally((function(){}))},initMap:function(e,t,a,i){var n=this;const o=new(s().Map)(e,{center:{x:100,y:100},zoom:1e3,mode:"ban",refreshDelayWhenZooming:!0,zoomWhenDrawing:!0,panWhenDrawing:!1,zoomWheelRatio:5,withHotKeys:!1}),l=new(s().Layer.Image)("layer-image",{src:t,width:i,height:a,crossOrigin:!1,position:{x:0,y:0}},{name:"图像层"},{zIndex:5});o.events.on("click",(e=>{console.log("--click--",e)})),o.events.on("drawDone",((t,a,i)=>{if(!(n.image_meta_info[e]["feature_layer"].features.length>=n.image_meta_info[e]["num"]))if("POINT"===t){a["sr"]=5;const t=new(s().Feature.Point)(""+ +new Date,a,{name:"point"},{fillStyle:"#3CB371"});n.image_meta_info[e]["feature_layer"].addFeature(t)}else if("LINE"===t){const t=o.getScale(),i=1/t,l=new(s().Feature.Line)(""+ +new Date,{...a,width:i},{name:"line"},{fillStyle:"rgba(255,255,255,0.5)",strokeStyle:"#3CB371",lineWidth:2,fill:!0});n.image_meta_info[e]["feature_layer"].addFeature(l)}else if("RECT"===t){const t=new(s().Feature.Rect)(""+ +new Date,a,{name:"rect"},{fillStyle:"rgba(255,255,255,0.5)",strokeStyle:"#3CB371",lineWidth:2,fill:!0});n.image_meta_info[e]["feature_layer"].addFeature(t)}else if("POLYGON"===t){const t=new(s().Feature.Polygon)(""+ +new Date,{points:a},{name:"polygon"},{fillStyle:"rgba(255,255,255,0.5)",strokeStyle:"#3CB371",lineWidth:2,fill:!0});n.image_meta_info[e]["feature_layer"].addFeature(t)}})),o.events.on("boundsChanged",(e=>{console.log("--map boundsChanged--")})),o.events.on("featureSelected",(t=>{n.image_meta_info[e]["feature_layer"].removeFeatureById(t.id)})),o.events.on("featureUnselected",(()=>{o.setActiveFeature(null)})),o.events.on("featureUpdated",((e,t)=>{console.log("feature updated")})),o.events.on("featureDeleted",(({id:e})=>{console.log("feature delete")})),o.addLayer(l);const r=new(s().Layer.Feature)("first-layer-feature",{name:"绘制层"},{zIndex:10});o.addLayer(r),n.image_meta_info[e]={},n.image_meta_info[e]["gmap"]=o,n.image_meta_info[e]["image_layer"]=l,n.image_meta_info[e]["feature_layer"]=r,n.image_meta_info[e]["mode"]=""},setMode:function(e,t,a){var i;switch(this.image_meta_info[e]["gmap"].setMode(t),this.image_meta_info[e]["mode"]=t,this.image_meta_info[e]["num"]=a,t){case"POINT":i={fillStyle:"#9370DB",strokeStyle:"#f00"},this.image_meta_info[e]["gmap"].setDrawingStyle(i);break;case"LINE":i={strokeStyle:"#FF0000",lineJoin:"round",lineCap:"round",lineWidth:5,arrow:!1},this.image_meta_info[e]["gmap"].setDrawingStyle(i);break;case"POLYLINE":i={strokeStyle:"#FF1493",lineJoin:"round",lineCap:"round",lineWidth:1},this.image_meta_info[e]["gmap"].setDrawingStyle(i);break;case"RECT":i={strokeStyle:"#f00",lineWidth:1},this.image_meta_info[e]["gmap"].setDrawingStyle(i);break;case"POLYGON":i={strokeStyle:"#00f",fillStyle:"#0f0",globalAlpha:.3,lineWidth:1,fill:!0,stroke:!0},this.image_meta_info[e]["gmap"].setDrawingStyle(i);break;case"TEXT":i={fillStyle:"#00f",lineWidth:30},this.image_meta_info[e]["gmap"].setDrawingStyle(i);break;default:break}}}},r=l,u=a(4249),m=(0,u.Z)(r,i,n,!1,null,"067764c1",null),p=m.exports}}]);
//# sourceMappingURL=603.e40f514d.js.map